<h2>Factura #{{ factura.numero }}</h2>

<!-- Detalles del cliente -->
<p><strong>Cliente:</strong> {{ factura.pedido.cliente.nombre }}</p>
<p><strong>Correo:</strong> {{ factura.pedido.cliente.correo_electronico }}</p>
<p><strong>Dirección:</strong> {{ factura.pedido.cliente.direccion }}</p>
<p><strong>Fecha de emisión:</strong> {{ factura.fecha }}</p>

<!-- Detalles del pedido -->
<h3>Detalle de productos</h3>
<table>
    <thead>
        <tr>
            <th>Producto</th>
            <th>Cantidad</th>
            <th>Precio Unitario</th>
            <th>Subtotal</th>
        </tr>
    </thead>
    <tbody>
        {% for item in factura.pedido.itempedido_set.all %}
        <tr>
            <td>{{ item.producto.nombre }}</td>
            <td>{{ item.cantidad }}</td>
            <td>${{ item.precio_unitario }}</td>
            <td>${{ item.subtotal }}</td>  <!-- Mostramos el subtotal calculado en el modelo -->
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Detalle de los impuestos aplicados -->
<h3>Impuestos Aplicados:</h3>
<ul>
    {% for item in factura.pedido.itempedido_set.all %}
        {% for impuesto in item.producto.impuestos.all %}
            <li>{{ impuesto.nombre }} - {{ impuesto.porcentaje }}%</li>
        {% endfor %}
    {% endfor %}
</ul>

<!-- Descuentos -->
{% if factura.descuento > 0 %}
<h3>Descuento Aplicado:</h3>
<p>- ${{ factura.descuento }}</p>
{% else %}
<p>No se aplicaron descuentos.</p>
{% endif %}

<!-- Totales -->
<h3>Totales</h3>
<p><strong>Subtotal:</strong> ${{ factura.subtotal }}</p>
<p><strong>Total de Impuestos:</strong> ${{ factura.impuesto_total }}</p>
<p><strong>Total:</strong> ${{ factura.total }}</p>

<!-- Promoción (si existe) -->
{% if factura.promocion %}
    <h3>Promoción Aplicada:</h3>
    <p>{{ factura.promocion.descripcion }} - Descuento adicional: ${{ factura.descuento }}</p>
{% else %}
    <p>No se aplicó ninguna promoción.</p>
{% endif %}

<!-- Enlace para generar el PDF -->
<a href="{% url 'generar_factura_pdf' factura.numero %}" class="btn btn-primary">Generar PDF</a>
